# Pixoo Integration for Home Assistant

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-41BDF5.svg)](https://github.com/hacs/integration)
[![License](https://img.shields.io/badge/License-BSD_3--Clause-blue.svg)](https://opensource.org/licenses/BSD-3-Clause)

Modern Home Assistant integration for **Divoom Pixoo** LED displays (Pixoo64, Pixoo Max, etc.). Display images, animated GIFs, scrolling text, and more on your Pixoo device directly from Home Assistant.

## Features

âœ¨ **Full Device Control**
- Power on/off and brightness adjustment
- Channel selection (Clock, Cloud Gallery, Visualizer, Custom)
- Screen rotation (0Â°, 90Â°, 180Â°, 270Â°)
- Mirror mode (horizontal flip)

ðŸ–¼ï¸ **Display Custom Content**
- Display images from URLs or local media
- Display animated GIFs
- Display scrolling text with color and direction control
- Clear display

ðŸ“¸ **Image Gallery & Slideshow**
- Media player entity for photo frame functionality
- Playlist support with duration per image
- Shuffle and repeat modes
- Manual navigation (next/previous)
- Supports media-source:// and http(s):// URLs

ðŸ”” **Notifications & Alerts**
- Persistent on-screen notifications
- Buzzer alerts with configurable duration and cycles
- Dismiss button to restore previous display
- Perfect for washing machine alerts, reminders, doorbell integration

â° **Built-in Tool Modes**
- Timer with minutes/seconds control
- Alarm with hour/minute configuration
- Stopwatch start/stop/reset
- Scoreboard with red/blue team scores
- Noise meter visualization

ðŸŽ¨ **Clock & Visualizer Selection**
- Dynamic clock face selection from cloud gallery
- Visualizer selection (music visualization)
- Custom channel page switching (1, 2, 3)

ðŸ“Š **Device Monitoring**
- Device information sensors (model, firmware, MAC)
- Network status sensors (IP, Wi-Fi signal strength)
- System configuration sensors (brightness, active channel)
- Weather and time sensors
- Tool state sensors (timer remaining, alarm time, stopwatch elapsed)

ðŸŽ¯ **Drawing Primitives** (Advanced)
- Draw pixels, lines, rectangles, and text
- Buffer management (reset, push)
- Batch drawing operations

## Requirements

- Home Assistant 2024.1 or newer
- Divoom Pixoo device (Pixoo 64, Pixoo Max, or Timebox Evo)
- Device connected to same network as Home Assistant
- Python 3.12 or newer

## Installation

### HACS (Recommended)

1. Open HACS in Home Assistant
2. Go to "Integrations"
3. Click the three dots in the top right corner
4. Select "Custom repositories"
5. Add repository URL: `https://github.com/YOUR_USERNAME/pixoo-ha`
6. Category: "Integration"
7. Click "Add"
8. Search for "Pixoo" and install

### Manual Installation

1. Copy the `custom_components/pixoo` folder to your Home Assistant `custom_components` directory
2. Restart Home Assistant

## Configuration

### Automatic Discovery (Recommended)

The integration supports automatic device discovery via SSDP:

1. Go to **Settings** â†’ **Devices & Services**
2. Click **+ Add Integration**
3. Search for "Pixoo"
4. Select your device from discovered devices
5. Click **Submit**

### Manual Configuration

If automatic discovery doesn't work:

1. Go to **Settings** â†’ **Devices & Services**
2. Click **+ Add Integration**
3. Search for "Pixoo"
4. Enter the IP address of your Pixoo device
5. Click **Submit**

## Usage Examples

### Basic Display Control

```yaml
# Turn on device and set brightness to 80%
service: light.turn_on
target:
  entity_id: light.pixoo_living_room
data:
  brightness: 204  # 0-255 scale (80% = 204)

# Change to clock channel
service: select.select_option
target:
  entity_id: select.pixoo_living_room_channel
data:
  option: "clock"
```

### Display Custom Images

```yaml
# Display image from URL
service: pixoo.display_image
target:
  entity_id: light.pixoo_living_room
data:
  url: "https://example.com/image.jpg"

# Display local media file
service: pixoo.display_image
target:
  entity_id: light.pixoo_living_room
data:
  url: "media-source://media_source/local/images/birthday.png"

# Display animated GIF
service: pixoo.display_gif
target:
  entity_id: light.pixoo_living_room
data:
  url: "https://example.com/animation.gif"
```

### Display Text Messages

```yaml
# Display scrolling text
service: pixoo.display_text
target:
  entity_id: light.pixoo_living_room
data:
  text: "Hello World!"
  color: "#FF0000"
  scroll_direction: "left"

# Multi-line positioned text
service: pixoo.display_text
target:
  entity_id: light.pixoo_living_room
data:
  text: "Line 1\nLine 2\nLine 3"
  x: 10
  y: 20
  color: "#00FF00"
```

### Image Gallery Slideshow

```yaml
# Play slideshow with 3 images (10 seconds each)
service: media_player.play_media
target:
  entity_id: media_player.pixoo_living_room
data:
  media_content_type: playlist
  media_content_id: >
    [
      {"url": "https://example.com/img1.jpg", "duration": 10},
      {"url": "https://example.com/img2.jpg", "duration": 15},
      {"url": "media-source://media_source/local/img3.png", "duration": 8}
    ]

# Enable shuffle
service: media_player.shuffle_set
target:
  entity_id: media_player.pixoo_living_room
data:
  shuffle: true

# Enable repeat (loop playlist)
service: media_player.repeat_set
target:
  entity_id: media_player.pixoo_living_room
data:
  repeat: all
```

### Notification with Buzzer

```yaml
# Play buzzer alert (3 cycles, 500ms on, 200ms off)
service: pixoo.play_buzzer
target:
  entity_id: light.pixoo_living_room
data:
  active_ms: 500
  off_ms: 200
  count: 3

# Dismiss notification (restore previous display)
service: button.press
target:
  entity_id: button.pixoo_living_room_dismiss_notification
```

### Tool Modes

```yaml
# Set 5-minute timer
service: number.set_value
target:
  entity_id: number.pixoo_living_room_timer_minutes
data:
  value: 5

service: switch.turn_on
target:
  entity_id: switch.pixoo_living_room_timer

# Set alarm for 7:30 AM
service: number.set_value
target:
  entity_id: number.pixoo_living_room_alarm_hour
data:
  value: 7

service: number.set_value
target:
  entity_id: number.pixoo_living_room_alarm_minute
data:
  value: 30

service: switch.turn_on
target:
  entity_id: switch.pixoo_living_room_alarm
```

### Automation Examples

#### Washing Machine Alert

```yaml
automation:
  - alias: "Washing Machine Done"
    trigger:
      - platform: state
        entity_id: binary_sensor.washing_machine_door
        from: "on"
        to: "off"
    action:
      - service: pixoo.display_text
        target:
          entity_id: light.pixoo_kitchen
        data:
          text: "Washing Done!"
          color: "#00FF00"
      - service: pixoo.play_buzzer
        target:
          entity_id: light.pixoo_kitchen
        data:
          count: 5
```

#### Birthday Reminder

```yaml
automation:
  - alias: "Birthday Reminder"
    trigger:
      - platform: time
        at: "08:00:00"
    condition:
      - condition: template
        value_template: >
          {{ now().month == 6 and now().day == 15 }}
    action:
      - service: pixoo.display_image
        target:
          entity_id: light.pixoo_living_room
        data:
          url: "media-source://media_source/local/birthday_cake.gif"
```

#### Doorbell Integration

```yaml
automation:
  - alias: "Doorbell Pressed"
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_button
        to: "on"
    action:
      - service: pixoo.display_text
        target:
          entity_id: light.pixoo_hallway
        data:
          text: "Someone at the door!"
          color: "#FF0000"
      - service: pixoo.play_buzzer
        target:
          entity_id: light.pixoo_hallway
        data:
          count: 3
```

## Entity Reference

### Platforms

| Platform | Entities | Description |
|----------|----------|-------------|
| **Light** | 1 | Power control and brightness |
| **Media Player** | 1 | Image gallery/slideshow |
| **Number** | 8 | Brightness, timer, alarm, scoreboard, gallery interval |
| **Switch** | 7 | Timer, alarm, stopwatch, scoreboard, noise meter, mirror mode |
| **Select** | 7 | Channel, rotation, temperature, time format, clock face, visualizer, custom page |
| **Sensor** | 10 | Device info, network status, system config, weather, time, tool states |
| **Button** | 4 | Dismiss notification, buzzer, reset buffer, push buffer |

**Total**: 40+ entities per device

### Services

#### Display Services

- `pixoo.display_image` - Display static image
- `pixoo.display_gif` - Display animated GIF
- `pixoo.display_text` - Display scrolling or positioned text
- `pixoo.clear_display` - Clear screen

#### Drawing Services

- `pixoo.draw_pixel` - Draw single pixel
- `pixoo.draw_line` - Draw line between two points
- `pixoo.draw_rectangle` - Draw rectangle (filled or outline)
- `pixoo.draw_text` - Draw text at position
- `pixoo.draw_image` - Draw image at position
- `pixoo.reset_buffer` - Clear drawing buffer
- `pixoo.push_buffer` - Send buffer to display

#### Tool Services

- `pixoo.play_buzzer` - Play buzzer alert
- `pixoo.list_animations` - Get available animations

#### Media Player Services

Standard Home Assistant media player services:
- `media_player.play_media` - Display image or start slideshow
- `media_player.media_play` - Resume slideshow
- `media_player.media_pause` - Pause slideshow
- `media_player.media_stop` - Stop slideshow and clear
- `media_player.media_next_track` - Next image
- `media_player.media_previous_track` - Previous image
- `media_player.shuffle_set` - Enable/disable shuffle
- `media_player.repeat_set` - Enable/disable repeat

## Troubleshooting

## Known Limitations (Write-Only API & Optimistic State)

Certain Pixoo device features do not expose read-back methods in the underlying API (write-only operations). The integration uses **optimistic state** and marks affected entities with `assumed_state = true` to provide responsive UI feedback:

| Feature | Entities | Read Method Present | Strategy |
|---------|----------|---------------------|----------|
| Channel selection | `select.*_channel` | No | Track last selected option (optimistic) |
| Timer (minutes/seconds, running) | `number.*_timer_*`, `switch.*_timer` | No | Store last configured duration & running flag |
| Alarm (hour/minute, enabled) | `number.*_alarm_*`, `switch.*_alarm` | No | Store last configured alarm time & enabled flag |
| Stopwatch (running) | `switch.*_stopwatch` | No | Optimistic running state only (no elapsed time) |
| Scoreboard (scores, enabled) | `number.*_scoreboard_*`, `switch.*_scoreboard` | No | Track last written scores & enabled flag |
| Noise Meter (enabled) | `switch.*_noise_meter` | No | Track enabled flag |

### What This Means
- States may **drift** if changed outside Home Assistant (e.g., mobile app, hardware button).
- State is **restored** after Home Assistant restarts from the last known value.
- These entities will not show "Unavailable"â€”instead they reflect the last command you sent.
- For absolute accuracy, manually re-send your desired state after external changes.

### Why Not Sensors for These States?
The PixooAsync library currently offers only these read methods: `get_device_info`, `get_network_status`, `get_system_config`, `get_animation_list`, `get_weather_info`, `get_time_info`. Timer/alarm/stopwatch/channel/scoreboard/noise meter states cannot be queried.

### Planned Enhancements
If upstream API support is added for:
```python
async def get_current_channel()
async def get_timer_config()
async def get_alarm_config()
async def get_stopwatch_config()
async def get_scoreboard_config()
async def get_noise_meter_config()
```
the integration will migrate from optimistic to authoritative state reporting.

### Workaround Patterns
- Automations can rely on your own input helpers if strict persistence is required.
- Use scripts to reassert desired state on startup (`homeassistant` start event).
- For stopwatch elapsed time, prefer external timing in automations until read API exists.

### Identifying Optimistic Entities
In the UI, these entities allow toggling even if the device is offline; failure logs will appear if a command cannot be delivered.

### Reliability Notes
- Brightness, rotation, mirror mode, weather, time, and basic system info are **authoritative** (queried periodically).
- Screen power (on/off) is reported by the device but may not always reflect rapid changesâ€”brightness + optimistic channel provide better contextual cues.

### Device Not Discovered

1. Ensure device is powered on and connected to Wi-Fi
2. Check that Home Assistant and Pixoo are on same network
3. Try manual configuration with device IP address
4. Check firewall rules allow SSDP (UDP port 1900)

### Connection Timeout Errors

1. Verify device IP address hasn't changed
2. Check network connectivity between HA and device
3. Try power cycling the Pixoo device
4. Use **Settings** â†’ **Devices & Services** â†’ **Pixoo** â†’ **Reconfigure**

### Image Display Issues

1. Check image URL is accessible from Home Assistant
2. Verify image size (max 10MB)
3. Ensure image format is supported (JPEG, PNG, GIF)
4. Check Home Assistant logs for detailed error messages

### Slideshow Not Auto-Advancing

1. Verify media player state is "playing" (not "paused")
2. Check playlist items have `duration > 0`
3. Ensure repeat mode is enabled if you want continuous playback
4. Check Home Assistant logs for timer errors

## Development

### Running Tests

```bash
# Install dependencies
pip install -r requirements_test.txt

# Run tests
pytest

# Run tests with coverage
pytest --cov=custom_components.pixoo --cov-report=html
```

### Code Quality

```bash
# Format code
ruff format custom_components/pixoo/

# Lint code
ruff check custom_components/pixoo/ --fix

# Type check
mypy custom_components/pixoo/ --strict
```

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Credits

- Built with [pixooasync](https://github.com/kmplngj/pixoo) Python library
- Inspired by the [original pixoo library](https://github.com/SomethingWithComputers/pixoo) by Ron Talman
- Community feedback from [Home Assistant forums](https://community.home-assistant.io/)

## Support

- **Issues**: [GitHub Issues](https://github.com/YOUR_USERNAME/pixoo-ha/issues)
- **Discussions**: [GitHub Discussions](https://github.com/YOUR_USERNAME/pixoo-ha/discussions)
- **Home Assistant Community**: [Pixoo Integration Thread](https://community.home-assistant.io/t/divoom-pixoo-64/)

---

**Status**: âœ¨ Production Ready  
**Version**: 1.0.0  
**Maintainer**: Jan Kampling (@kmplngj)  
**Date**: November 10, 2025
